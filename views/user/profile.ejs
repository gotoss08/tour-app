<% include ../partials/header_start.ejs %>
<link rel="stylesheet" href="/css/profile.css">
<link rel="stylesheet" href="/css/animate.min.css">
<script src="/js/noty.min.js"></script>
<% include ../partials/header_end.ejs %>

<div class="container mt-5">
    <div class="col-12 mt-4 profile">
        <% if(String(session.userId) === String(user._id) ) { %>
        <h1 class="mb-4"><%= __('user.profile.my.header') %></h1>
        <p><span class="text-muted"><%= __('user.profile.username') %>:</span> <%= user.username %></p>
        <p><span class="text-muted"><%= __('user.profile.email') %>:</span> <%= user.email %></p>
        <p><span class="text-muted">User id:</span> <%= user._id %></p>
        <p><span class="text-muted">Session id:</span> <%= session.userId %></p>
        <% } else { %>
        <h1><%= __('user.profile.of') %><%= user.username %></h1>
        <% } %>
        <hr>
        <h2><%= __('user.profile.posts.header') %></h2>
        <div class="list-group mt-3">
            <% for(var i = 0; i < posts.length; i++) { %>
            <% var post = posts[i]; %>
                <% if(String(session.userId) === String(user._id) ) { %>
                    <div class="list-group-item" id="post-<%= post._id %>">
                        <a class="align-middle" href="/post/<%= post._id %>" title="<%= post.title %>"><%= limitText(post.title, 70) %></a>
                        <div class="button-group d-sm-inline-flex d-md-block d-xl-inline">
                            <button class="btn btn-outline-danger float-right" onclick="removePost('<%= post._id %>')"><i class="fas fa-trash-alt mr-1"></i><%= __('user.profile.posts.remove') %></button>
                            <a role="button" href="/post/edit/<%= post._id %>" class="btn btn-outline-primary float-right mr-1"><i class="fas fa-edit mr-1"></i><%= __('user.profile.posts.edit') %></a>
                        </div>
                    </div>
                <% } else { %>
                    <a href="/post/<%= post._id %>" class="list-group-item"><%= post.title %></a>
                <% } %>
            <% } %>
        </div>
    </div>
</div>

<script>
    $(() => {
        removePost = (postId) => {
            $.ajax({
                url: '/post/remove/' + postId,
                method: 'POST',
                success: (data) => $('#post-' + postId).animateCss('fadeOutLeft', () => $('#post-' + postId).remove())
            });
        }
    });
</script>

<% include ../partials/footer.ejs %>